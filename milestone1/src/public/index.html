<!DOCTYPE html>
<html>
  <head>
    <title>MPEG-DASH Media Player</title>
    <script src="https://cdn.dashjs.org/latest/dash.all.min.js"></script>
  </head>
  <body>
    <div id="videoList"></div>
    <!-- <video id="videoPlayer" controls width="600"></video>
    <div>
      <div id="playPauseBtn">Play/Pause</div>
      <button id="seekBtn">Seek</button>
      <select id="resolutionSelect">
        <option value="auto">Auto</option>
        <option value="480p">480p</option>
        <option value="720p">720p</option>
        <option value="1080p">1080p</option>
      </select>
    </div>

    <script>
      var video = document.getElementById("videoPlayer");
      var player = dashjs.MediaPlayer().create();
      player.initialize(video, "/path/to/manifest.mpd", false);

      document
        .getElementById("playPauseBtn")
        .addEventListener("click", function () {
          if (video.paused) {
            video.play();
          } else {
            video.pause();
          }
        });

      document.getElementById("seekBtn").addEventListener("click", function () {
        var seekTime = prompt("Enter time to seek (in seconds):");
        video.currentTime = seekTime;
      });

      document
        .getElementById("resolutionSelect")
        .addEventListener("change", function () {
          var selectedRes = this.value;
          if (selectedRes === "auto") {
            player.setAutoSwitchQualityFor("video", true);
          } else {
            var quality =
              selectedRes === "1080p" ? 2 : selectedRes === "720p" ? 1 : 0;
            player.setAutoSwitchQualityFor("video", false);
            player.setQualityFor("video", quality);
          }
        });
    </script>
    -->
    <script>
      const videoListContainer = document.getElementById("videoList");
      async function getThumbnails() {
        try {
            const count = 10;
            const response = await fetch("http://doitand711gang.cse356.compas.cs.stonybrook.edu/api/videos", {
                method: "POST",
                headers: {
                "Content-Type": "application/json",
                },
                body: JSON.stringify({ count }),
            });

            if (response.ok) {
                const videoMetadatas = await response.json();
                const videos = videoMetadatas.videos;

                videos.forEach(async video => {
                    const id = video.id;

                    const thumbnailMetadata = await fetch(`http://doitand711gang.cse356.compas.cs.stonybrook.edu/api/thumbnail/${id}`, {
                        method: "GET",
                        headers: {
                        "Content-Type": "application/json",
                        },
                    });
                    
                    const thumbnailUrl = thumbnailMetadata.url;

                    displayThumbnail(thumbnailUrl, id);
                });                
            } else {
                console.log("Failed to fetch thumbnails");
            }
        } catch (error) {
            console.log("Error occured during fetch:", error);
        }
      }

      function displayThumbnail(url, id) {
        const img = document.createElement("img");
        img.src = url;
        img.alt = "thumbnail";
        img.onclick = function () {
            handleThumbnailClick(id);
        }
        // img.href = `play.html`;

        videoListContainer.appendChild(img);
      }

      async function handleThumbnailClick(id) {
        try {
            await fetch(`http://doitand711gang.cse356.compas.cs.stonybrook.edu/play/${id}`, {
                method: "GET",
                headers: {
                "Content-Type": "application/json",
                },
            });

            
            window.location.href = `/play/${id}`;
            console.log(`/play/${id}`)
        } catch (error) {
            console.log("Error occured during fetch:", error);
        }
      }

      window.onload = function() {
        getThumbnails();
      }
    </script>
  </body>
</html>
