<!DOCTYPE html>
<html>
  <head>
    <title>MPEG-DASH Media Player</title>
    <script src="https://cdn.dashjs.org/latest/dash.all.min.js"></script>
  </head>
  <body>
    <div id="container"></div>

    <script>
      const container = document.getElementById("container");

    //   const id = window.location.pathname.split("/")[2];

    //   var video = document.getElementById("videoPlayer");
    //   var player = dashjs.MediaPlayer().create();

    //   console.log(id)
    //   player.initialize(video, `http://doitand711gang.cse356.compas.cs.stonybrook.edu/api/manifest/${id}_output.mpd`, true);

    //   document
    //     .getElementById("playPauseBtn")
    //     .addEventListener("click", function () {
    //       if (video.paused) {
    //         video.play();
    //       } else {
    //         video.pause();
    //       }
    //     }
    //   );
        ////////////////////////////////////////////////////////////////////

        async function loadNextVideo() { 
            try {
                const response = await fetch()
            } catch (error) {
                console.log("Error fetching videos:", error);
            }
        }
        window.addEventListener("scroll", () => {
            if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 50) {
                loadNextVideo();
            }
        })

        async function getVideos() {
        try {
            const count = 10;
            const response = await fetch("http://doitand711gang.cse356.compas.cs.stonybrook.edu/api/videos", {
                method: "POST",
                headers: {
                "Content-Type": "application/json",
                },
                body: JSON.stringify({ count }),
            });

            if (response.ok) {
                const videoMetadatas = await response.json();
                const videos = videoMetadatas.videos;

                videos.forEach(async video => {
                    const id = video.id;

                    const videoContainer = document.createElement("div");

                    const _video = document.createElement("video");
                    var player = dashjs.MediaPlayer().create();

                    console.log(id)
                    player.initialize(video, `http://doitand711gang.cse356.compas.cs.stonybrook.edu/api/manifest/${id}_output.mpd`, true);
                    _video.controls = true;
                    const playPauseBtn = document.createElement("div");
                    playPauseBtn.addEventListener("click", function () {
                        if (_video.paused) {
                            _video.play();
                        } else {
                            _video.pause();
                        }}
                    );
                    videoContainer.appendChild(_video);
                    videoContainer.appendChild(playPauseBtn);
                    container.appendChild(videoContainer);
                });                
            }
        } catch (error) {
            console.log("Error occured during fetch:", error);
        }
      }

      window.onload = async function() {
        getVideos();
      }
    </script>
   
     </body>
</html>
